
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Library for Data Quality checks">
      
      
        <meta name="author" content="Demetrius Albuquerque">
      
      
      
      
      
      <link rel="icon" href="../../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Module sumeh.engine.duckdb_engine - Sumeh DQ — Unified Data Quality Framework</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-sumehengineduckdb_engine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Sumeh DQ — Unified Data Quality Framework" class="md-header__button md-logo" aria-label="Sumeh DQ — Unified Data Quality Framework" data-md-component="logo">
      
  <img src="../../../img/sumeh.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sumeh DQ — Unified Data Quality Framework
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Module sumeh.engine.duckdb_engine
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Sumeh DQ — Unified Data Quality Framework" class="md-nav__button md-logo" aria-label="Sumeh DQ — Unified Data Quality Framework" data-md-component="logo">
      
  <img src="../../../img/sumeh.svg" alt="logo">

    </a>
    Sumeh DQ — Unified Data Quality Framework
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services-config.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Services.Config
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services-utils.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Services.Utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engine/engines.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Engine overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engine/engine-dask.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dask engine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engine/engine-duckdb.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DuckDB engine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engine/engine-polars.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Polars engine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engine/engine-pyspark.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pyspark engine
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tests
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine.__RULE_DISPATCH" class="md-nav__link">
    <span class="md-ellipsis">
      __RULE_DISPATCH
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine.__RuleCtx" class="md-nav__link">
    <span class="md-ellipsis">
      __RuleCtx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine.__compare_schemas" class="md-nav__link">
    <span class="md-ellipsis">
      __compare_schemas
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine.__duckdb_schema_to_list" class="md-nav__link">
    <span class="md-ellipsis">
      __duckdb_schema_to_list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine.__escape_single_quotes" class="md-nav__link">
    <span class="md-ellipsis">
      __escape_single_quotes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine.__rules_to_duckdb_df" class="md-nav__link">
    <span class="md-ellipsis">
      __rules_to_duckdb_df
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._are_complete" class="md-nav__link">
    <span class="md-ellipsis">
      _are_complete
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._are_unique" class="md-nav__link">
    <span class="md-ellipsis">
      _are_unique
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._build_union_sql" class="md-nav__link">
    <span class="md-ellipsis">
      _build_union_sql
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._format_sequence" class="md-nav__link">
    <span class="md-ellipsis">
      _format_sequence
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._has_pattern" class="md-nav__link">
    <span class="md-ellipsis">
      _has_pattern
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._is_between" class="md-nav__link">
    <span class="md-ellipsis">
      _is_between
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._is_complete" class="md-nav__link">
    <span class="md-ellipsis">
      _is_complete
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._is_contained_in" class="md-nav__link">
    <span class="md-ellipsis">
      _is_contained_in
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._is_equal_than" class="md-nav__link">
    <span class="md-ellipsis">
      _is_equal_than
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._is_greater_or_equal_than" class="md-nav__link">
    <span class="md-ellipsis">
      _is_greater_or_equal_than
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._is_greater_than" class="md-nav__link">
    <span class="md-ellipsis">
      _is_greater_than
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._is_less_or_equal_than" class="md-nav__link">
    <span class="md-ellipsis">
      _is_less_or_equal_than
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._is_less_than" class="md-nav__link">
    <span class="md-ellipsis">
      _is_less_than
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._is_unique" class="md-nav__link">
    <span class="md-ellipsis">
      _is_unique
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._not_contained_in" class="md-nav__link">
    <span class="md-ellipsis">
      _not_contained_in
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine._satisfies" class="md-nav__link">
    <span class="md-ellipsis">
      _satisfies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine.summarize" class="md-nav__link">
    <span class="md-ellipsis">
      summarize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine.validate" class="md-nav__link">
    <span class="md-ellipsis">
      validate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sumeh.engine.duckdb_engine.validate_schema" class="md-nav__link">
    <span class="md-ellipsis">
      validate_schema
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="module-sumehengineduckdb_engine">Module <code>sumeh.engine.duckdb_engine</code><a class="headerlink" href="#module-sumehengineduckdb_engine" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

        <p>This module provides utilities for generating and validating SQL expressions 
and data quality rules using DuckDB. It includes functions for building SQL 
expressions, validating dataframes against rules, summarizing rule violations, 
and schema validation.</p>


<p><span class="doc-section-title">Classes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>A dataclass representing the context required to generate SQL 
      expressions for data quality rules.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="__escape_single_quotes(txt) (sumeh.engine.duckdb_engine.__escape_single_quotes)" href="#sumeh.engine.duckdb_engine.__escape_single_quotes">__escape_single_quotes</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>str) -&gt; str:
Escapes single quotes in a string for SQL compatibility.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_format_sequence(value) (sumeh.engine.duckdb_engine._format_sequence)" href="#sumeh.engine.duckdb_engine._format_sequence">_format_sequence</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Any) -&gt; str:
Formats a sequence (list, tuple, or string) into a SQL-compatible 
representation for IN/NOT IN clauses.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_is_complete(r) (sumeh.engine.duckdb_engine._is_complete)" href="#sumeh.engine.duckdb_engine._is_complete">_is_complete</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if a column is not NULL.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_are_complete(r) (sumeh.engine.duckdb_engine._are_complete)" href="#sumeh.engine.duckdb_engine._are_complete">_are_complete</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if all columns in a list are not NULL.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_is_unique(r) (sumeh.engine.duckdb_engine._is_unique)" href="#sumeh.engine.duckdb_engine._is_unique">_is_unique</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if a column has unique values.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_are_unique(r) (sumeh.engine.duckdb_engine._are_unique)" href="#sumeh.engine.duckdb_engine._are_unique">_are_unique</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if a combination of columns has unique values.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_is_greater_than(r) (sumeh.engine.duckdb_engine._is_greater_than)" href="#sumeh.engine.duckdb_engine._is_greater_than">_is_greater_than</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if a column's value is greater than a given value.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_is_less_than(r) (sumeh.engine.duckdb_engine._is_less_than)" href="#sumeh.engine.duckdb_engine._is_less_than">_is_less_than</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if a column's value is less than a given value.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_is_greater_or_equal_than(r) (sumeh.engine.duckdb_engine._is_greater_or_equal_than)" href="#sumeh.engine.duckdb_engine._is_greater_or_equal_than">_is_greater_or_equal_than</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if a column's value is greater than or equal to a given value.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_is_less_or_equal_than(r) (sumeh.engine.duckdb_engine._is_less_or_equal_than)" href="#sumeh.engine.duckdb_engine._is_less_or_equal_than">_is_less_or_equal_than</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if a column's value is less than or equal to a given value.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_is_equal_than(r) (sumeh.engine.duckdb_engine._is_equal_than)" href="#sumeh.engine.duckdb_engine._is_equal_than">_is_equal_than</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if a column's value is equal to a given value.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_is_between(r) (sumeh.engine.duckdb_engine._is_between)" href="#sumeh.engine.duckdb_engine._is_between">_is_between</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if a column's value is between two values.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_has_pattern(r) (sumeh.engine.duckdb_engine._has_pattern)" href="#sumeh.engine.duckdb_engine._has_pattern">_has_pattern</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if a column's value matches a regular expression pattern.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_is_contained_in(r) (sumeh.engine.duckdb_engine._is_contained_in)" href="#sumeh.engine.duckdb_engine._is_contained_in">_is_contained_in</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if a column's value is in a given sequence.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_not_contained_in(r) (sumeh.engine.duckdb_engine._not_contained_in)" href="#sumeh.engine.duckdb_engine._not_contained_in">_not_contained_in</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression to check if a column's value is not in a given sequence.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_satisfies(r) (sumeh.engine.duckdb_engine._satisfies)" href="#sumeh.engine.duckdb_engine._satisfies">_satisfies</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>__RuleCtx) -&gt; str:
Generates a SQL expression based on a custom condition provided as a string.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="_build_union_sql(rules) (sumeh.engine.duckdb_engine._build_union_sql)" href="#sumeh.engine.duckdb_engine._build_union_sql">_build_union_sql</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>List[Dict]) -&gt; str:
Builds a SQL query that combines multiple rule-based conditions into a UNION ALL query.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>









  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="sumeh.engine.duckdb_engine.__RULE_DISPATCH" class="doc doc-heading">
            <code class=" language-python"><span class="n">__RULE_DISPATCH</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;is_complete&#39;</span><span class="p">:</span> <span class="n">_is_complete</span><span class="p">,</span> <span class="s1">&#39;are_complete&#39;</span><span class="p">:</span> <span class="n">_are_complete</span><span class="p">,</span> <span class="s1">&#39;is_unique&#39;</span><span class="p">:</span> <span class="n">_is_unique</span><span class="p">,</span> <span class="s1">&#39;are_unique&#39;</span><span class="p">:</span> <span class="n">_are_unique</span><span class="p">,</span> <span class="s1">&#39;is_greater_than&#39;</span><span class="p">:</span> <span class="n">_is_greater_than</span><span class="p">,</span> <span class="s1">&#39;is_less_than&#39;</span><span class="p">:</span> <span class="n">_is_less_than</span><span class="p">,</span> <span class="s1">&#39;is_greater_or_equal_than&#39;</span><span class="p">:</span> <span class="n">_is_greater_or_equal_than</span><span class="p">,</span> <span class="s1">&#39;is_less_or_equal_than&#39;</span><span class="p">:</span> <span class="n">_is_less_or_equal_than</span><span class="p">,</span> <span class="s1">&#39;is_equal_than&#39;</span><span class="p">:</span> <span class="n">_is_equal_than</span><span class="p">,</span> <span class="s1">&#39;is_between&#39;</span><span class="p">:</span> <span class="n">_is_between</span><span class="p">,</span> <span class="s1">&#39;has_pattern&#39;</span><span class="p">:</span> <span class="n">_has_pattern</span><span class="p">,</span> <span class="s1">&#39;is_contained_in&#39;</span><span class="p">:</span> <span class="n">_is_contained_in</span><span class="p">,</span> <span class="s1">&#39;not_contained_in&#39;</span><span class="p">:</span> <span class="n">_not_contained_in</span><span class="p">,</span> <span class="s1">&#39;satisfies&#39;</span><span class="p">:</span> <span class="n">_satisfies</span><span class="p">}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#sumeh.engine.duckdb_engine.__RULE_DISPATCH" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

    </div>

</div>


<div class="doc doc-object doc-class">



<h2 id="sumeh.engine.duckdb_engine.__RuleCtx" class="doc doc-heading">
            <code>__RuleCtx</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#sumeh.engine.duckdb_engine.__RuleCtx" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>__RuleCtx is a context class used to define rules for processing data.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="sumeh.engine.duckdb_engine.__RuleCtx.column">column</span></code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Represents the column(s) to which the rule applies. 
          It can be a string (for a single column) or a list of strings (for multiple columns).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="sumeh.engine.duckdb_engine.__RuleCtx.value">value</span></code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value associated with the rule. The type of this value depends on the specific rule implementation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="sumeh.engine.duckdb_engine.__RuleCtx.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the rule, typically used to indicate the type of check being performed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">__RuleCtx</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    __RuleCtx is a context class used to define rules for processing data.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        column (Any): Represents the column(s) to which the rule applies. </span>
<span class="sd">                      It can be a string (for a single column) or a list of strings (for multiple columns).</span>
<span class="sd">        value (Any): The value associated with the rule. The type of this value depends on the specific rule implementation.</span>
<span class="sd">        name (str): The name of the rule, typically used to indicate the type of check being performed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">column</span><span class="p">:</span> <span class="n">Any</span>  <span class="c1"># str ou list[str]</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># check_type</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine.__compare_schemas" class="doc doc-heading">
            <code class=" language-python"><span class="n">__compare_schemas</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine.__compare_schemas" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Compare two lists of schema definitions and identify discrepancies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>actual</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="SchemaDef = Dict[str, Any]

  
      module-attribute
   (sumeh.services.utils.SchemaDef)" href="../../services/services-utils/#sumeh.services.utils.SchemaDef">SchemaDef</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of actual schema definitions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>expected</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="SchemaDef = Dict[str, Any]

  
      module-attribute
   (sumeh.services.utils.SchemaDef)" href="../../services/services-utils/#sumeh.services.utils.SchemaDef">SchemaDef</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of expected schema definitions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[bool, List[Tuple[str, str]]]: A tuple where the first element is a boolean indicating </p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether the schemas match (True if they match, False otherwise), and the second element </p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="bool">bool</span>, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="str">str</span>, <span title="str">str</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>is a list of tuples describing the discrepancies. Each tuple contains:
- The field name (str).
- A description of the discrepancy (str), such as "missing", "type mismatch", 
  "nullable but expected non-nullable", or "extra column".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>A field is considered "missing" if it exists in the expected schema but not in the actual schema.</li>
<li>A "type mismatch" occurs if the data type of a field in the actual schema does not match 
  the expected data type.</li>
<li>A field is considered "nullable but expected non-nullable" if it is nullable in the actual 
  schema but not nullable in the expected schema.</li>
<li>An "extra column" is a field that exists in the actual schema but not in the expected schema.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>sumeh/services/utils.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__compare_schemas</span><span class="p">(</span><span class="n">actual</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SchemaDef</span><span class="p">],</span> <span class="n">expected</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SchemaDef</span><span class="p">],)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare two lists of schema definitions and identify discrepancies.</span>

<span class="sd">    Args:</span>
<span class="sd">        actual (List[SchemaDef]): The list of actual schema definitions.</span>
<span class="sd">        expected (List[SchemaDef]): The list of expected schema definitions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[bool, List[Tuple[str, str]]]: A tuple where the first element is a boolean indicating </span>
<span class="sd">        whether the schemas match (True if they match, False otherwise), and the second element </span>
<span class="sd">        is a list of tuples describing the discrepancies. Each tuple contains:</span>
<span class="sd">            - The field name (str).</span>
<span class="sd">            - A description of the discrepancy (str), such as &quot;missing&quot;, &quot;type mismatch&quot;, </span>
<span class="sd">              &quot;nullable but expected non-nullable&quot;, or &quot;extra column&quot;.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - A field is considered &quot;missing&quot; if it exists in the expected schema but not in the actual schema.</span>
<span class="sd">        - A &quot;type mismatch&quot; occurs if the data type of a field in the actual schema does not match </span>
<span class="sd">          the expected data type.</span>
<span class="sd">        - A field is considered &quot;nullable but expected non-nullable&quot; if it is nullable in the actual </span>
<span class="sd">          schema but not nullable in the expected schema.</span>
<span class="sd">        - An &quot;extra column&quot; is a field that exists in the actual schema but not in the expected schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">exp_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;field&quot;</span><span class="p">]:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">expected</span><span class="p">}</span>
    <span class="n">act_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;field&quot;</span><span class="p">]:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">actual</span><span class="p">}</span>

    <span class="n">erros</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">fld</span><span class="p">,</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">exp_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">fld</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">act_map</span><span class="p">:</span>
            <span class="n">erros</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fld</span><span class="p">,</span> <span class="s2">&quot;missing&quot;</span><span class="p">))</span>
            <span class="k">continue</span>
        <span class="n">act</span> <span class="o">=</span> <span class="n">act_map</span><span class="p">[</span><span class="n">fld</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">exp</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]:</span>
            <span class="n">erros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">fld</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;type mismatch (got </span><span class="si">{</span><span class="n">act</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, expected </span><span class="si">{</span><span class="n">exp</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s2">&quot;nullable&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">exp</span><span class="p">[</span><span class="s2">&quot;nullable&quot;</span><span class="p">]:</span>
            <span class="n">erros</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fld</span><span class="p">,</span> <span class="s2">&quot;nullable but expected non-nullable&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">exp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_length&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># 2. campos extras (se quiser)</span>
    <span class="n">extras</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">act_map</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">exp_map</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="n">extras</span><span class="p">:</span>
        <span class="n">erros</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fld</span><span class="p">,</span> <span class="s2">&quot;extra column&quot;</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">erros</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">erros</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine.__duckdb_schema_to_list" class="doc doc-heading">
            <code class=" language-python"><span class="n">__duckdb_schema_to_list</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine.__duckdb_schema_to_list" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Retrieve the schema of a DuckDB table as a list of dictionaries.
This function queries the schema of the specified table in a DuckDB database
and returns a list of dictionaries where each dictionary represents a column
in the table, including its name, data type, nullability, and maximum length.
Args:
    conn (dk.DuckDBPyConnection): The DuckDB connection object.
    table (str): The name of the table whose schema is to be retrieved.
Returns:
    List[Dict[str, Any]]: A list of dictionaries, each containing the following keys:
        - "field" (str): The name of the column.
        - "data_type" (str): The data type of the column in lowercase.
        - "nullable" (bool): Whether the column allows NULL values.
        - "max_length" (None): Always None, as DuckDB does not provide maximum length information.</p>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__duckdb_schema_to_list</span><span class="p">(</span><span class="n">conn</span><span class="p">:</span> <span class="n">dk</span><span class="o">.</span><span class="n">DuckDBPyConnection</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the schema of a DuckDB table as a list of dictionaries.</span>
<span class="sd">    This function queries the schema of the specified table in a DuckDB database</span>
<span class="sd">    and returns a list of dictionaries where each dictionary represents a column</span>
<span class="sd">    in the table, including its name, data type, nullability, and maximum length.</span>
<span class="sd">    Args:</span>
<span class="sd">        conn (dk.DuckDBPyConnection): The DuckDB connection object.</span>
<span class="sd">        table (str): The name of the table whose schema is to be retrieved.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List[Dict[str, Any]]: A list of dictionaries, each containing the following keys:</span>
<span class="sd">            - &quot;field&quot; (str): The name of the column.</span>
<span class="sd">            - &quot;data_type&quot; (str): The data type of the column in lowercase.</span>
<span class="sd">            - &quot;nullable&quot; (bool): Whether the column allows NULL values.</span>
<span class="sd">            - &quot;max_length&quot; (None): Always None, as DuckDB does not provide maximum length information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df_info</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PRAGMA table_info(&#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="s2">&quot;nullable&quot;</span><span class="p">:</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;notnull&quot;</span><span class="p">]),</span>
            <span class="s2">&quot;max_length&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_info</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine.__escape_single_quotes" class="doc doc-heading">
            <code class=" language-python"><span class="n">__escape_single_quotes</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine.__escape_single_quotes" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Escapes single quotes in a given string by replacing each single quote
with two single quotes. This is commonly used to sanitize strings for
use in SQL queries.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>txt</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input string to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The processed string with single quotes escaped.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__escape_single_quotes</span><span class="p">(</span><span class="n">txt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Escapes single quotes in a given string by replacing each single quote</span>
<span class="sd">    with two single quotes. This is commonly used to sanitize strings for</span>
<span class="sd">    use in SQL queries.</span>

<span class="sd">    Args:</span>
<span class="sd">        txt (str): The input string to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The processed string with single quotes escaped.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine.__rules_to_duckdb_df" class="doc doc-heading">
            <code class=" language-python"><span class="n">__rules_to_duckdb_df</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine.__rules_to_duckdb_df" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Converts a list of rule dictionaries into a DuckDB-compatible SQL query string.
Each rule in the input list is processed to generate a SQL <code>SELECT</code> statement
with the following fields:
- <code>col</code>: The column name(s) associated with the rule.
- <code>rule</code>: The name of the rule (check type).
- <code>pass_threshold</code>: A numeric threshold value for the rule, defaulting to 1.0 if not provided.
- <code>value</code>: The value associated with the rule, which can be a string, list, tuple, or <code>NULL</code>.
Rules with the <code>execute</code> field set to <code>False</code> are skipped.
If the input list is empty or all rules are skipped, the function returns a SQL query
that selects <code>NULL</code> values with a <code>LIMIT 0</code>.
Args:
    rules (List[Dict]): A list of dictionaries, where each dictionary represents a rule
        with the following keys:
        - <code>field</code> (str or list): The column(s) associated with the rule.
        - <code>check_type</code> (str): The name of the rule.
        - <code>value</code> (optional): The value associated with the rule.
        - <code>threshold</code> (optional, float): The numeric threshold for the rule.
        - <code>execute</code> (optional, bool): Whether the rule should be executed (default is <code>True</code>).
Returns:
    str: A DuckDB-compatible SQL query string representing the rules.</p>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__rules_to_duckdb_df</span><span class="p">(</span><span class="n">rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a list of rule dictionaries into a DuckDB-compatible SQL query string.</span>
<span class="sd">    Each rule in the input list is processed to generate a SQL `SELECT` statement</span>
<span class="sd">    with the following fields:</span>
<span class="sd">    - `col`: The column name(s) associated with the rule.</span>
<span class="sd">    - `rule`: The name of the rule (check type).</span>
<span class="sd">    - `pass_threshold`: A numeric threshold value for the rule, defaulting to 1.0 if not provided.</span>
<span class="sd">    - `value`: The value associated with the rule, which can be a string, list, tuple, or `NULL`.</span>
<span class="sd">    Rules with the `execute` field set to `False` are skipped.</span>
<span class="sd">    If the input list is empty or all rules are skipped, the function returns a SQL query</span>
<span class="sd">    that selects `NULL` values with a `LIMIT 0`.</span>
<span class="sd">    Args:</span>
<span class="sd">        rules (List[Dict]): A list of dictionaries, where each dictionary represents a rule</span>
<span class="sd">            with the following keys:</span>
<span class="sd">            - `field` (str or list): The column(s) associated with the rule.</span>
<span class="sd">            - `check_type` (str): The name of the rule.</span>
<span class="sd">            - `value` (optional): The value associated with the rule.</span>
<span class="sd">            - `threshold` (optional, float): The numeric threshold for the rule.</span>
<span class="sd">            - `execute` (optional, bool): Whether the rule should be executed (default is `True`).</span>
<span class="sd">    Returns:</span>
<span class="sd">        str: A DuckDB-compatible SQL query string representing the rules.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">parts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execute&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">ctx</span> <span class="o">=</span> <span class="n">__RuleCtx</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;field&quot;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;check_type&quot;</span><span class="p">])</span>

        <span class="c1"># Formatação da coluna (string ou lista)</span>
        <span class="n">col</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">column</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">column</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">ctx</span><span class="o">.</span><span class="n">column</span>
        <span class="n">col_sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">__escape_single_quotes</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

        <span class="c1"># Formatação do nome da regra</span>
        <span class="n">rule_sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">__escape_single_quotes</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

        <span class="c1"># Threshold com fallback seguro</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">thr</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">thr</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># Formatação do valor</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">val_sql</span> <span class="o">=</span> <span class="s2">&quot;NULL&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">val_sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">__escape_single_quotes</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val_sql</span> <span class="o">=</span> <span class="n">_format_sequence</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">val_sql</span> <span class="o">=</span> <span class="s2">&quot;NULL&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val_sql</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;SELECT </span><span class="si">{</span><span class="n">col_sql</span><span class="si">}</span><span class="s2"> AS col, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rule_sql</span><span class="si">}</span><span class="s2"> AS rule, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">thr</span><span class="si">}</span><span class="s2"> AS pass_threshold, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val_sql</span><span class="si">}</span><span class="s2"> AS value&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;SELECT NULL AS col, NULL AS rule, NULL AS pass_threshold, NULL AS value LIMIT 0&quot;</span>

    <span class="n">union_sql</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">UNION ALL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="s2">&quot;SELECT DISTINCT col, rule, pass_threshold, value</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;FROM (</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">union_sql</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;) AS t&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._are_complete" class="doc doc-heading">
            <code class=" language-python"><span class="n">_are_complete</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._are_complete" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Constructs a SQL condition string that checks if all specified columns in a rule context are not NULL.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rule context containing the list of column names to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL condition string in the format "(column1 IS NOT NULL AND column2 IS NOT NULL ...)".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_are_complete</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs a SQL condition string that checks if all specified columns in a rule context are not NULL.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): The rule context containing the list of column names to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL condition string in the format &quot;(column1 IS NOT NULL AND column2 IS NOT NULL ...)&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="s2">&quot; AND &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2"> IS NOT NULL&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">parts</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._are_unique" class="doc doc-heading">
            <code class=" language-python"><span class="n">_are_unique</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._are_unique" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generates a SQL query string to check if the combination of specified columns
in a table is unique for each row.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A context object containing the column names to be checked
           for uniqueness.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL query string that evaluates whether the combination of the
 specified columns is unique for each row in the table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_are_unique</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a SQL query string to check if the combination of specified columns</span>
<span class="sd">    in a table is unique for each row.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): A context object containing the column names to be checked</span>
<span class="sd">                       for uniqueness.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL query string that evaluates whether the combination of the</span>
<span class="sd">             specified columns is unique for each row in the table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">combo_outer</span> <span class="o">=</span> <span class="s2">&quot; || &#39;|&#39; || &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;tbl.</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="p">)</span>
    <span class="n">combo_inner</span> <span class="o">=</span> <span class="s2">&quot; || &#39;|&#39; || &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;d2.</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;(SELECT COUNT(*)                  </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;   FROM tbl AS d2                 </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;   WHERE (</span><span class="si">{</span><span class="n">combo_inner</span><span class="si">}</span><span class="s2">) = (</span><span class="si">{</span><span class="n">combo_outer</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;) = 1&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._build_union_sql" class="doc doc-heading">
            <code class=" language-python"><span class="n">_build_union_sql</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._build_union_sql" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Constructs a SQL query that combines multiple rule-based checks into a single query
using UNION ALL. Each rule specifies a condition to be checked on a table, and the
resulting query flags rows that do not satisfy the condition.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries where each dictionary represents a rule.
Each rule should contain the following keys:
- "check_type" (str): The type of check to perform.
- "field" (str): The column name to apply the check on.
- "value" (optional): The value to use in the check.
- "execute" (optional, bool): Whether to execute the rule. Defaults to True.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL query string that combines all active rules using UNION ALL. If no</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>rules are active, returns a query that produces an empty result set.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If a rule's "check_type" is not recognized, a warning is issued, and the rule
  is skipped.</li>
<li>The resulting query includes a "dq_status" column that indicates the rule
  that flagged the row, formatted as "column:check_type:value".</li>
<li>If no rules are active, the query returns an empty result set with the same
  structure as the input table.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_build_union_sql</span><span class="p">(</span><span class="n">rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs a SQL query that combines multiple rule-based checks into a single query</span>
<span class="sd">    using UNION ALL. Each rule specifies a condition to be checked on a table, and the</span>
<span class="sd">    resulting query flags rows that do not satisfy the condition.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules (List[Dict]): A list of dictionaries where each dictionary represents a rule.</span>
<span class="sd">            Each rule should contain the following keys:</span>
<span class="sd">            - &quot;check_type&quot; (str): The type of check to perform.</span>
<span class="sd">            - &quot;field&quot; (str): The column name to apply the check on.</span>
<span class="sd">            - &quot;value&quot; (optional): The value to use in the check.</span>
<span class="sd">            - &quot;execute&quot; (optional, bool): Whether to execute the rule. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL query string that combines all active rules using UNION ALL. If no</span>
<span class="sd">        rules are active, returns a query that produces an empty result set.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - If a rule&#39;s &quot;check_type&quot; is not recognized, a warning is issued, and the rule</span>
<span class="sd">          is skipped.</span>
<span class="sd">        - The resulting query includes a &quot;dq_status&quot; column that indicates the rule</span>
<span class="sd">          that flagged the row, formatted as &quot;column:check_type:value&quot;.</span>
<span class="sd">        - If no rules are active, the query returns an empty result set with the same</span>
<span class="sd">          structure as the input table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pieces</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execute&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">check</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;check_type&quot;</span><span class="p">]</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">__RULE_DISPATCH</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">builder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Regra desconhecida: </span><span class="si">{</span><span class="n">check</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">ctx</span> <span class="o">=</span> <span class="n">__RuleCtx</span><span class="p">(</span>
            <span class="n">column</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;field&quot;</span><span class="p">],</span>
            <span class="n">value</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">check</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">expr_ok</span> <span class="o">=</span> <span class="n">builder</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>  <span class="c1"># condição “passa”</span>
        <span class="n">dq_tag</span> <span class="o">=</span> <span class="n">__escape_single_quotes</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">check</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">pieces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;SELECT *, &#39;</span><span class="si">{</span><span class="n">dq_tag</span><span class="si">}</span><span class="s2">&#39; AS dq_status FROM tbl WHERE NOT (</span><span class="si">{</span><span class="n">expr_ok</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="c1"># se não há regras ativas: devolve DF vazio</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pieces</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;SELECT *, &#39;&#39; AS dq_status FROM tbl WHERE 1=0&quot;</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">UNION ALL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._format_sequence" class="doc doc-heading">
            <code class=" language-python"><span class="n">_format_sequence</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._format_sequence" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Formats a sequence-like input into a string representation suitable for SQL queries.</p>


<details class="converts-inputs-into-a-tuple-like-string-format" open>
  <summary>Converts inputs into a tuple-like string format</summary>
  <ul>
<li>'BR,US' -&gt; "('BR','US')"</li>
<li>['BR', 'US'] -&gt; "('BR','US')"</li>
<li>('BR', 'US') -&gt; "('BR','US')"</li>
</ul>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input value to be formatted. Can be a string, list, or tuple.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string representation of the input in the format "('item1','item2',...)".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the input value is None or cannot be interpreted as a sequence.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If the input is a string, it attempts to parse it as a Python literal.</li>
<li>If parsing fails, it splits the string by commas and processes the resulting parts.</li>
<li>Empty or invalid elements are ignored in the output.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_format_sequence</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formats a sequence-like input into a string representation suitable for SQL queries.</span>

<span class="sd">    Converts inputs into a tuple-like string format:</span>
<span class="sd">        - &#39;BR,US&#39; -&gt; &quot;(&#39;BR&#39;,&#39;US&#39;)&quot;</span>
<span class="sd">        - [&#39;BR&#39;, &#39;US&#39;] -&gt; &quot;(&#39;BR&#39;,&#39;US&#39;)&quot;</span>
<span class="sd">        - (&#39;BR&#39;, &#39;US&#39;) -&gt; &quot;(&#39;BR&#39;,&#39;US&#39;)&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        value (Any): The input value to be formatted. Can be a string, list, or tuple.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A string representation of the input in the format &quot;(&#39;item1&#39;,&#39;item2&#39;,...)&quot;.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the input value is None or cannot be interpreted as a sequence.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - If the input is a string, it attempts to parse it as a Python literal.</span>
<span class="sd">        - If parsing fails, it splits the string by commas and processes the resulting parts.</span>
<span class="sd">        - Empty or invalid elements are ignored in the output.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value cannot be None for IN/NOT IN&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># tenta interpretar como literal Python</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot; []()&#39;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>

    <span class="k">return</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">seq</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._has_pattern" class="doc doc-heading">
            <code class=" language-python"><span class="n">_has_pattern</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._has_pattern" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Constructs a SQL expression to check if a column's value matches a given regular expression pattern.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An object containing the column name and the value to be used as the pattern.
           The <code>value</code> attribute is expected to be a string or convertible to a string,
           and the <code>column</code> attribute is the name of the column to be checked.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL expression string that uses the REGEXP_MATCHES function to evaluate
 whether the column matches the escaped pattern.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_has_pattern</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs a SQL expression to check if a column&#39;s value matches a given regular expression pattern.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): An object containing the column name and the value to be used as the pattern.</span>
<span class="sd">                       The `value` attribute is expected to be a string or convertible to a string,</span>
<span class="sd">                       and the `column` attribute is the name of the column to be checked.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL expression string that uses the REGEXP_MATCHES function to evaluate</span>
<span class="sd">             whether the column matches the escaped pattern.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="n">__escape_single_quotes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;REGEXP_MATCHES(</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2">, &#39;</span><span class="si">{</span><span class="n">pat</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._is_between" class="doc doc-heading">
            <code class=" language-python"><span class="n">_is_between</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._is_between" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Constructs a SQL BETWEEN clause for a given rule context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rule context containing the column name and value(s).
           The <code>value</code> attribute can be a list, tuple, or a string
           representation of a range (e.g., "lo, hi").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL BETWEEN clause in the format "column BETWEEN lo AND hi".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If <code>r.value</code> is a list or tuple, it is expected to contain exactly two elements
  representing the lower (lo) and upper (hi) bounds.</li>
<li>If <code>r.value</code> is a string, it will be split by commas and stripped of any
  surrounding brackets, parentheses, or quotes to extract the bounds.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_is_between</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs a SQL BETWEEN clause for a given rule context.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): The rule context containing the column name and value(s).</span>
<span class="sd">                       The `value` attribute can be a list, tuple, or a string</span>
<span class="sd">                       representation of a range (e.g., &quot;lo, hi&quot;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL BETWEEN clause in the format &quot;column BETWEEN lo AND hi&quot;.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - If `r.value` is a list or tuple, it is expected to contain exactly two elements</span>
<span class="sd">          representing the lower (lo) and upper (hi) bounds.</span>
<span class="sd">        - If `r.value` is a string, it will be split by commas and stripped of any</span>
<span class="sd">          surrounding brackets, parentheses, or quotes to extract the bounds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">val</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot; []()&#39;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2"> BETWEEN </span><span class="si">{</span><span class="n">lo</span><span class="si">}</span><span class="s2"> AND </span><span class="si">{</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._is_complete" class="doc doc-heading">
            <code class=" language-python"><span class="n">_is_complete</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._is_complete" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Constructs a SQL condition to check if a column is not NULL.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An object containing context information, including the column name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL condition string in the format "<column> IS NOT NULL".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_is_complete</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs a SQL condition to check if a column is not NULL.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): An object containing context information, including the column name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL condition string in the format &quot;&lt;column&gt; IS NOT NULL&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2"> IS NOT NULL&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._is_contained_in" class="doc doc-heading">
            <code class=" language-python"><span class="n">_is_contained_in</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._is_contained_in" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generates a SQL fragment that checks if a column's value is contained within a sequence of values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A context object containing the column name and the sequence of values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL fragment in the format "<column> IN (<value1>, <value2>, ...)".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_is_contained_in</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a SQL fragment that checks if a column&#39;s value is contained within a sequence of values.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): A context object containing the column name and the sequence of values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL fragment in the format &quot;&lt;column&gt; IN (&lt;value1&gt;, &lt;value2&gt;, ...)&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2"> IN </span><span class="si">{</span><span class="n">_format_sequence</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._is_equal_than" class="doc doc-heading">
            <code class=" language-python"><span class="n">_is_equal_than</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._is_equal_than" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generates a SQL equality condition string for a given rule context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rule context containing the column and value to compare.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string representing the SQL equality condition in the format "column = value".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_is_equal_than</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a SQL equality condition string for a given rule context.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): The rule context containing the column and value to compare.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A string representing the SQL equality condition in the format &quot;column = value&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._is_greater_or_equal_than" class="doc doc-heading">
            <code class=" language-python"><span class="n">_is_greater_or_equal_than</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._is_greater_or_equal_than" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generates a SQL expression to check if a column's value is greater than or equal to a specified value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A context object containing the column name and the value to compare.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL expression in the format "<column> &gt;= <value>".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_is_greater_or_equal_than</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a SQL expression to check if a column&#39;s value is greater than or equal to a specified value.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): A context object containing the column name and the value to compare.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL expression in the format &quot;&lt;column&gt; &gt;= &lt;value&gt;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._is_greater_than" class="doc doc-heading">
            <code class=" language-python"><span class="n">_is_greater_than</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._is_greater_than" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generates a SQL condition string to check if a column's value is greater than a specified value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A context object containing the column name and the value to compare.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL condition string in the format "<column> &gt; <value>".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_is_greater_than</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a SQL condition string to check if a column&#39;s value is greater than a specified value.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): A context object containing the column name and the value to compare.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL condition string in the format &quot;&lt;column&gt; &gt; &lt;value&gt;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._is_less_or_equal_than" class="doc doc-heading">
            <code class=" language-python"><span class="n">_is_less_or_equal_than</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._is_less_or_equal_than" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generates a SQL condition string that checks if a column's value is less than or equal to a specified value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A context object containing the column name and the value to compare.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL condition string in the format "<column> &lt;= <value>".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_is_less_or_equal_than</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a SQL condition string that checks if a column&#39;s value is less than or equal to a specified value.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): A context object containing the column name and the value to compare.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL condition string in the format &quot;&lt;column&gt; &lt;= &lt;value&gt;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2"> &lt;= </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._is_less_than" class="doc doc-heading">
            <code class=" language-python"><span class="n">_is_less_than</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._is_less_than" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generates a SQL condition string that checks if a column's value is less than a specified value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A context object containing the column name and the value to compare against.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL condition string in the format "<column> &lt; <value>".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_is_less_than</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a SQL condition string that checks if a column&#39;s value is less than a specified value.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): A context object containing the column name and the value to compare against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL condition string in the format &quot;&lt;column&gt; &lt; &lt;value&gt;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._is_unique" class="doc doc-heading">
            <code class=" language-python"><span class="n">_is_unique</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._is_unique" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generates a SQL expression to check if a column value is unique within a table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A context object containing metadata, including the column name to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL string that evaluates to True if the column value is unique, otherwise False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_is_unique</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a SQL expression to check if a column value is unique within a table.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): A context object containing metadata, including the column name to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL string that evaluates to True if the column value is unique, otherwise False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;(SELECT COUNT(*)                            </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;   FROM tbl AS d2                           </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;   WHERE d2.</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2"> = tbl.</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2">     </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;) = 1&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._not_contained_in" class="doc doc-heading">
            <code class=" language-python"><span class="n">_not_contained_in</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._not_contained_in" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generates a SQL expression that checks if a column's value is not contained 
within a specified sequence of values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A context object containing the column name and the sequence 
           of values to check against.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SQL string in the format "<column> NOT IN (<value1>, <value2>, ...)".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_not_contained_in</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a SQL expression that checks if a column&#39;s value is not contained </span>
<span class="sd">    within a specified sequence of values.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): A context object containing the column name and the sequence </span>
<span class="sd">                       of values to check against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A SQL string in the format &quot;&lt;column&gt; NOT IN (&lt;value1&gt;, &lt;value2&gt;, ...)&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">column</span><span class="si">}</span><span class="s2"> NOT IN </span><span class="si">{</span><span class="n">_format_sequence</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine._satisfies" class="doc doc-heading">
            <code class=" language-python"><span class="n">_satisfies</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine._satisfies" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Constructs a string representation of the given rule context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="__RuleCtx


  
      dataclass
   (sumeh.engine.duckdb_engine.__RuleCtx)" href="#sumeh.engine.duckdb_engine.__RuleCtx">__RuleCtx</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rule context containing a value to be formatted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string in the format "(value)" where 'value' is the value of the rule context.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_satisfies</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="n">__RuleCtx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs a string representation of the given rule context.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (__RuleCtx): The rule context containing a value to be formatted.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A string in the format &quot;(value)&quot; where &#39;value&#39; is the value of the rule context.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine.summarize" class="doc doc-heading">
            <code class=" language-python"><span class="n">summarize</span><span class="p">(</span><span class="n">df_rel</span><span class="p">,</span> <span class="n">rules</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">total_rows</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine.summarize" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Summarizes data quality checks for a given DuckDB relation based on specified rules.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df_rel</code>
            </td>
            <td>
                  <code><span title="duckdb.DuckDBPyRelation">DuckDBPyRelation</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The DuckDB relation containing the data to be analyzed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries defining the data quality rules to be applied.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conn</code>
            </td>
            <td>
                  <code><span title="duckdb.DuckDBPyConnection">DuckDBPyConnection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The DuckDB connection used to execute SQL queries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_rows</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total number of rows in the dataset. If not provided, 
                        it must be calculated externally.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="duckdb.DuckDBPyRelation">DuckDBPyRelation</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dk.DuckDBPyRelation: A DuckDB relation containing the summary of data quality checks, 
                    including pass rates, violation counts, and statuses for each rule.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The function creates a temporary view named "violations_raw" from the input relation.</li>
<li>It uses SQL to compute violations, pass rates, and statuses based on the provided rules.</li>
<li>The output includes metadata such as timestamps, rule thresholds, and overall status 
    (PASS/FAIL) for each rule.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">summarize</span><span class="p">(</span><span class="n">df_rel</span><span class="p">:</span> <span class="n">dk</span><span class="o">.</span><span class="n">DuckDBPyRelation</span><span class="p">,</span><span class="n">rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span><span class="n">conn</span><span class="p">:</span> <span class="n">dk</span><span class="o">.</span><span class="n">DuckDBPyConnection</span><span class="p">,</span><span class="n">total_rows</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dk</span><span class="o">.</span><span class="n">DuckDBPyRelation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Summarizes data quality checks for a given DuckDB relation based on specified rules.</span>

<span class="sd">    Args:</span>
<span class="sd">        df_rel (dk.DuckDBPyRelation): The DuckDB relation containing the data to be analyzed.</span>
<span class="sd">        rules (List[Dict]): A list of dictionaries defining the data quality rules to be applied.</span>
<span class="sd">        conn (dk.DuckDBPyConnection): The DuckDB connection used to execute SQL queries.</span>
<span class="sd">        total_rows (Optional[int]): The total number of rows in the dataset. If not provided, </span>
<span class="sd">                                    it must be calculated externally.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dk.DuckDBPyRelation: A DuckDB relation containing the summary of data quality checks, </span>
<span class="sd">                                including pass rates, violation counts, and statuses for each rule.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The function creates a temporary view named &quot;violations_raw&quot; from the input relation.</span>
<span class="sd">        - It uses SQL to compute violations, pass rates, and statuses based on the provided rules.</span>
<span class="sd">        - The output includes metadata such as timestamps, rule thresholds, and overall status </span>
<span class="sd">            (PASS/FAIL) for each rule.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rules_sql</span> <span class="o">=</span> <span class="n">__rules_to_duckdb_df</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="n">df_rel</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="s2">&quot;violations_raw&quot;</span><span class="p">)</span>

    <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        WITH</span>
<span class="s2">        rules      AS (</span><span class="si">{</span><span class="n">rules_sql</span><span class="si">}</span><span class="s2">),</span>
<span class="s2">        violations AS (</span>
<span class="s2">            SELECT</span>
<span class="s2">                split_part(dq_status, &#39;:&#39;, 1) AS col,</span>
<span class="s2">                split_part(dq_status, &#39;:&#39;, 2) AS rule,</span>
<span class="s2">                split_part(dq_status, &#39;:&#39;, 2) AS value,</span>
<span class="s2">                COUNT(*)               AS violations</span>
<span class="s2">            FROM violations_raw</span>
<span class="s2">            WHERE dq_status IS NOT NULL</span>
<span class="s2">                AND dq_status &lt;&gt; &#39;&#39;</span>
<span class="s2">            GROUP BY col, rule, value, value</span>
<span class="s2">        ),</span>
<span class="s2">        total_rows AS (</span>
<span class="s2">            SELECT </span><span class="si">{</span><span class="n">total_rows</span><span class="si">}</span><span class="s2"> AS cnt</span>
<span class="s2">        )</span>
<span class="s2">        SELECT</span>
<span class="s2">        ROW_NUMBER() OVER ()                            AS id,</span>
<span class="s2">        date_trunc(&#39;minute&#39;, NOW())                     AS timestamp,</span>
<span class="s2">        &#39;Quality Check&#39;                                 AS check,</span>
<span class="s2">        &#39;WARNING&#39;                                       AS level,</span>
<span class="s2">        r.col         AS col,</span>
<span class="s2">        r.rule,</span>
<span class="s2">        r.value,</span>
<span class="s2">        tr.cnt                                         AS rows,</span>
<span class="s2">        COALESCE(v.violations, 0)                      AS violations,</span>
<span class="s2">        (tr.cnt - COALESCE(v.violations, 0))::DOUBLE / tr.cnt          AS pass_rate,</span>
<span class="s2">        r.pass_threshold,</span>
<span class="s2">        CASE</span>
<span class="s2">            WHEN (tr.cnt - COALESCE(v.violations,0))::DOUBLE / tr.cnt </span>
<span class="s2">             &gt;= r.pass_threshold THEN &#39;PASS&#39;</span>
<span class="s2">            ELSE &#39;FAIL&#39;</span>
<span class="s2">        END                                            AS status</span>
<span class="s2">        FROM rules r</span>
<span class="s2">        LEFT JOIN violations v ON r.col = v.col AND r.rule = v.rule,</span>
<span class="s2">            total_rows tr</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">conn</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine.validate" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate</span><span class="p">(</span><span class="n">df_rel</span><span class="p">,</span> <span class="n">rules</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine.validate" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Validates a DuckDB relation against a set of rules and returns the processed relation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df_rel</code>
            </td>
            <td>
                  <code><span title="duckdb.DuckDBPyRelation">DuckDBPyRelation</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input DuckDB relation to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries representing validation rules.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>conn</code>
            </td>
            <td>
                  <code><span title="duckdb.DuckDBPyConnection">DuckDBPyConnection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The DuckDB connection object used for executing SQL queries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="duckdb.DuckDBPyRelation">DuckDBPyRelation</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dk.DuckDBPyRelation: A tuple containing:
- The final DuckDB relation with aggregated validation statuses.
- The raw DuckDB relation resulting from applying the validation rules.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The function creates a temporary view of the input relation named "tbl".</li>
<li>Validation rules are combined into a union SQL query using <code>_build_union_sql</code>.</li>
<li>The final relation includes all original columns and an aggregated <code>dq_status</code> column.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="n">df_rel</span><span class="p">:</span> <span class="n">dk</span><span class="o">.</span><span class="n">DuckDBPyRelation</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">conn</span><span class="p">:</span> <span class="n">dk</span><span class="o">.</span><span class="n">DuckDBPyConnection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dk</span><span class="o">.</span><span class="n">DuckDBPyRelation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates a DuckDB relation against a set of rules and returns the processed relation.</span>

<span class="sd">    Args:</span>
<span class="sd">        df_rel (dk.DuckDBPyRelation): The input DuckDB relation to be validated.</span>
<span class="sd">        rules (List[Dict]): A list of dictionaries representing validation rules.</span>
<span class="sd">        conn (dk.DuckDBPyConnection): The DuckDB connection object used for executing SQL queries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dk.DuckDBPyRelation: A tuple containing:</span>
<span class="sd">            - The final DuckDB relation with aggregated validation statuses.</span>
<span class="sd">            - The raw DuckDB relation resulting from applying the validation rules.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The function creates a temporary view of the input relation named &quot;tbl&quot;.</span>
<span class="sd">        - Validation rules are combined into a union SQL query using `_build_union_sql`.</span>
<span class="sd">        - The final relation includes all original columns and an aggregated `dq_status` column.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df_rel</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="s2">&quot;tbl&quot;</span><span class="p">)</span>

    <span class="n">union_sql</span> <span class="o">=</span> <span class="n">_build_union_sql</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="n">cols_df</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;PRAGMA table_info(&#39;tbl&#39;)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
    <span class="n">colnames</span> <span class="o">=</span> <span class="n">cols_df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">cols_sql</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">colnames</span><span class="p">)</span>

    <span class="n">raw_sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="n">union_sql</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">raw</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">raw_sql</span><span class="p">)</span>

    <span class="n">final_sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">        </span><span class="si">{</span><span class="n">cols_sql</span><span class="si">}</span><span class="s2">,</span>
<span class="s2">        STRING_AGG(dq_status, &#39;;&#39;) AS dq_status</span>
<span class="s2">    FROM raw</span>
<span class="s2">    GROUP BY </span><span class="si">{</span><span class="n">cols_sql</span><span class="si">}</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">final</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">final_sql</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">final</span><span class="p">,</span> <span class="n">raw</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="sumeh.engine.duckdb_engine.validate_schema" class="doc doc-heading">
            <code class=" language-python"><span class="n">validate_schema</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span></code>

<a href="#sumeh.engine.duckdb_engine.validate_schema" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Validates the schema of a DuckDB table against an expected schema.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>conn</code>
            </td>
            <td>
                  <code><span title="duckdb.DuckDBPyConnection">DuckDBPyConnection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The DuckDB connection object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>expected</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries representing the expected schema.
Each dictionary should define the expected attributes of the schema, such as column names and types.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the table whose schema is to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="bool">bool</span>, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="str">str</span>, <span title="str">str</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[bool, List[Tuple[str, str]]]: A tuple where the first element is a boolean indicating
whether the actual schema matches the expected schema, and the second element is a list
of tuples describing the mismatches (if any). Each tuple contains the column name and
a description of the mismatch.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>sumeh/engine/duckdb_engine.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_schema</span><span class="p">(</span><span class="n">conn</span><span class="p">:</span> <span class="n">dk</span><span class="o">.</span><span class="n">DuckDBPyConnection</span><span class="p">,</span> <span class="n">expected</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates the schema of a DuckDB table against an expected schema.</span>

<span class="sd">    Args:</span>
<span class="sd">        conn (dk.DuckDBPyConnection): The DuckDB connection object.</span>
<span class="sd">        expected (List[Dict[str, Any]]): A list of dictionaries representing the expected schema.</span>
<span class="sd">            Each dictionary should define the expected attributes of the schema, such as column names and types.</span>
<span class="sd">        table (str): The name of the table whose schema is to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[bool, List[Tuple[str, str]]]: A tuple where the first element is a boolean indicating</span>
<span class="sd">            whether the actual schema matches the expected schema, and the second element is a list</span>
<span class="sd">            of tuples describing the mismatches (if any). Each tuple contains the column name and</span>
<span class="sd">            a description of the mismatch.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">__duckdb_schema_to_list</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">__compare_schemas</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>